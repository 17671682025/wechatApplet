"use strict";function n(n){t(wx.request,n)}function t(n,t){var e=t.success,i=t.fail,r=!1,o=null;t.success=function(n){if(!r){o&&clearTimeout(o);"function"==typeof e&&e(n)}};t.fail=function(){if(!r){o&&clearTimeout(o);"function"==typeof i&&i()}};n(t);o=setTimeout(()=>{o&&clearTimeout(o);r=!0;"function"==typeof i&&i(r)},t.timeout||j)}function e(t){try{n(t)}catch(n){b().e("请求失败: "+n)}}function i(n){return cn.encode(n,!1)}function r(n){return cn.decode(n)}function o(n){for(var t="",e=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],i=0;i<Number(n);i++)t+=e[Math.round(Math.random()*(e.length-1))];return t}function u(n){return!Number.isNaN(parseInt(n,10))}function c(n,t){for(var e=String(n).split("."),i=String(t).split("."),r=0;r<Math.max(e.length,i.length);r++){var o=parseInt(e[r]||0,10),u=parseInt(i[r]||0,10);if(o>u)return 1;if(o<u)return-1}return 0}function a(n){return JSON.parse(JSON.stringify(n))}function s(n,t){return!(!t||0===t.length||t.length>n.length)&&n.substr(0,t.length)===t}function f(n,t){return!(!t||0===n.length||t.length>n.length)&&n.substring(n.length-t.length)===t}function l(n){if(void 0===n||null===n)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(n),e=1;e<arguments.length;e++){var i=arguments[e];if(i)for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t}function d(n,t){if(n===t)return!0;if(n&&"object"==typeof n&&t&&"object"==typeof t){if(Object.keys(n).length!==Object.keys(t).length)return!1;for(var e in n){if(Object.prototype.hasOwnProperty.call(t,e))return!1;if(!d(n[e],t[e]))return!1}return!0}return!1}function p(n){var t=null;switch(n){case Tn.HALF_SESSION:t=h();break;case Tn.CLOSE_SESSION:t=g();break;case Tn.EKV:t=v()}return t}function h(){var n=null,t=Nn().cloneCurrentSession();t&&(n={header:{st:"1"},analytics:{sessions:[t]}});return n}function g(){var n=null,t={},e=Nn().cloneCurrentSession();if(e){var i=Y().get(),r=ln().get();Array.isArray(i)&&i.length&&(e.pages=an.clone(i));Array.isArray(r)&&r.length&&(e.shares=an.clone(r));Y().clear();ln().clear();t.sessions=[e]}var o=gn().getEkvs();if(o){t.ekvs=an.clone(o);gn().clear()}(t.sessions||t.ekvs)&&(n={analytics:t});return n}function v(){var n=null,t=gn().getEkvs();if(t){n={analytics:{ekvs:an.clone(t)}};gn().clear()}return n}function _(n){return{h:y(n.header,On),a:E(n.analytics,An)}}function y(n,t){var e=m(n,t);n.id_tracking&&(e[t.id_tracking||"id_tracking"]=m(n.id_tracking,wn));return e}function m(n,t){var e={};for(var i in n)t[i]?e[t[i]]=n[i]:e[i]=n[i];return e}function E(n,t){var e={};if(n)for(var i in n)n[i]&&(e[t[i]]=n[i]);return e}function S(n,t,i,r){In.instance().setIdType(sn().getIdType());In.instance().setIdTracking(sn().getIdTracking());var o=sn().getUserId();o&&n.analytics&&(n.analytics.active_user={puid:o,provider:sn().getProvider()});var u=an.clone(In.instance().get());n.header=an.assign(u,n.header,{ts:Date.now(),testToken:Un().getToken(),traceId:an.getRandomStr(10)+Date.now()+an.getRandomStr(9)});var c=_(n),a=x.stringify(c),s={url:G.LOG_URL,method:"POST",data:an.base64Encode(a),success:function(n){var e=n.code||n.status||n.statusCode;if(200===e||413===e){b().i("数据发送成功: ",a);I((n.data||{}).imprint);"function"==typeof t&&t(n)}else{b().w("数据发送失败: ",a);"function"==typeof i&&i()}},fail:function(n){b().w("超时: ",a);"function"==typeof i&&i()},complete:function(){"function"==typeof r&&r()}};e(an.assign(s,T()))}function I(n){if(n){F().set(G.IMPRINT,n);In.instance().setItem(G.IMPRINT,n);var t=x.parse(an.base64Decode(n));b().v("imprint: %o",t);var e=t.report_policy;if(e&&an.isNumber(e)){F().set(G.REPORT_POLICY,e);if(e===G.REPORT_POLICY_INTERVAL){var i=t.report_interval;if(i&&an.isNumber(i)){i<=G.EVENT_SEND_MIN_INTERVAL?i=G.EVENT_SEND_MIN_INTERVAL:i>G.EVENT_SEND_MAX_INTERVAL&&(i=G.EVENT_SEND_MAX_INTERVAL);F().set(G.REPORT_INTERVAL_TIME,i)}}}t.ttn_invalid&&Un().clear()}}function T(){;"wxmp/json";return{header:{"Content-Type":"wxmp/json","Msg-Type":"wxmp/json"}}}function N(n){var t=n,e=[];this.enqueue=function(n){"number"==typeof t&&this.size()>=t&&this.dequeue();e.push(n)};this.dequeue=function(){return e.shift()};this.front=function(){return e[0]};this.isEmpty=function(){return 0===e.length};this.clear=function(){e.length=0};this.size=function(){return e.length};this.items=function(){return e};this.print=function(){console.log(e.toString())}}function A(n,t){this.id=n;this.ts=Date.now();var e=typeof t;if("string"===e&&t)this[n]=t;else if("object"===e)for(var i in t)({}).hasOwnProperty.call(t,i)&&(this[i]=t[i])}function O(){function n(){sn().init(function(){In.instance().init();b().v("Header初始化成功")})}function t(n,t){return"number"!=typeof o||"number"!=typeof t||(o<=0||n-o>t)}function e(n,t){if(!n||"string"!=typeof n){b().e('please check trackEvent id. id should be "string" and not null');return!1}var e={id:1,ts:1,du:1};if(e[n]){b().e("eventId不能与以下保留字冲突: "+e.join(","));return!1}if(n.length>G.MAX_EVENTID_LENGTH){b().e("The maximum length of event id shall not exceed "+G.MAX_EVENTID_LENGTH);return!1}if(t&&("object"!=typeof t||Array.isArray(t))&&"string"!=typeof t){b().e("please check trackEvent properties. properties should be string or object(not include Array)");return!1}if("object"==typeof t){var i=0;for(var r in t)if({}.hasOwnProperty.call(t,r)){if(r.length>G.MAX_PROPERTY_KEY_LENGTH){b().e("The maximum length of property key shall not exceed "+G.MAX_PROPERTY_KEY_LENGTH);return!1}if(i>=G.MAX_PROPERTY_KEYS_COUNT){b().e("The maximum count of properties shall not exceed "+G.MAX_PROPERTY_KEYS_COUNT);return!1}if(e[r]){b().e("属性中的key不能与以下保留字冲突: "+e.join(","));return!1}i+=1}}return!0}var i=!1,r=!1,o=0;this.init=function(t){b().v("sdk version: "+G.IMPL_VERSION);i?b().v("Lib重复实例化"):F().load(function(){b().v("cache初始化成功: ",F().getAll());n();i=!0;"function"==typeof t&&t();b().tip("SDK集成成功")})};this.resume=function(n){if(i&&!r){b().v("showOptions: ",n);var t=this;r=!0;var e=Nn().resume(n),o=Nn().getCurrentSessionId();gn().setSessionId(o);Un().init(function(){Dn().load();e&&Dn().add(Tn.HALF_SESSION,{},function(){V().useOpenid()&&V().autoGetOpenid()&&!sn().getId()?sn().getOpenIdAsync({success:function(n){b().v("获取openid成功: %s",n);t.setOpenid(n)},fail:function(){b().v("获取openid失败")}}):Dn().send()})})}};this.pause=function(){if(i){r=!1;o=0;Nn().pause();V().uploadUserInfo()&&Ln().update();Dn().send(Tn.CLOSE_SESSION,{},function(){Dn().save();F().save();b().v("cache save success")})}};this.setOpenid=function(n){b().v("setOpenId: %s",n);sn().setOpenid(n);Dn().send()};this.setUnionid=function(n){b().v("setUnionid: %s",n);sn().setUnionid(n)};this.setUserid=function(n,t){b().v("setUserid: %s",n,t);sn().setUserid(n,t)};this.trackEvent=function(n,r){if(i){b().v("event: ",n,r);if(e(n,r)){var u=new A(n,r);gn().addEvent(u);var c=!!Un().getToken(),a=c?0:G.EVENT_SEND_DEFAULT_INTERVAL,s=Date.now();if(t(s,a)){o=s;Dn().send(Tn.EKV,{noCache:c},function(){})}}}};this.trackShare=function(n){if(i){try{n=ln().add(n);b().v("sharePath: ",n.path)}catch(n){b().v("shareAppMessage: ",n)}return n}};this.trackPageStart=function(n){i&&Y().addPageStart(n)};this.trackPageEnd=function(n){i&&Y().addPageEnd(n)}}function w(){}function R(n,t,e){var i=n[t];n[t]=function(n){e.call(this,n);i&&i.call(this,n)}}function k(n){try{Fn.init(n)}catch(n){b().v("onAppLaunch: ",n)}}function P(n){try{Fn.resume(n)}catch(n){b().v("onAppShow: ",n)}}function U(){try{Fn.pause()}catch(n){b().v("onAppHide: ",n)}}function D(){try{Fn.trackPageStart(this.route)}catch(n){b().v("onPageShow: ",n)}}function L(){try{Fn.trackPageEnd(this.route)}catch(n){b().v("onPageHide: ",n)}}var C="[UMENG] -- ",b=function(){function n(){this.setDebug=function(n){e=n};this.d=function(){if(e)try{"string"==typeof arguments[0]&&(arguments[0]=C+arguments[0]);console.debug.apply(console,arguments)}catch(n){}};this.i=function(){try{if(e)try{"string"==typeof arguments[0]&&(arguments[0]=C+arguments[0]);console.info.apply(console,arguments)}catch(n){}}catch(n){}};this.e=function(){if(e)try{"string"==typeof arguments[0]&&(arguments[0]=C+arguments[0]);console.error.apply(console,arguments)}catch(n){}};this.w=function(){if(e)try{"string"==typeof arguments[0]&&(arguments[0]=C+arguments[0]);console.warn.apply(console,arguments)}catch(n){}};this.v=function(){if(e)try{"string"==typeof arguments[0]&&(arguments[0]=C+arguments[0]);console.log.apply(console,arguments)}catch(n){}};this.t=function(){if(e)try{console.table.apply(console,arguments)}catch(n){}};this.tip=function(){try{"string"==typeof arguments[0]&&(arguments[0]=C+arguments[0]);console.log.apply(console,arguments)}catch(n){}};this.tip_w=function(){try{"string"==typeof arguments[0]&&(arguments[0]=C+arguments[0]);console.warn.apply(console,arguments)}catch(n){}};this.err=function(){try{"string"==typeof arguments[0]&&(arguments[0]=C+arguments[0]);console.error.apply(console,arguments)}catch(n){}}}var t=null,e=!1;return function(){null===t&&(t=new n);return t}}(),M={set:function(n,t,e){var i,r={key:n,success:function(n){"function"==typeof e&&e(n)},fail:function(){"function"==typeof e&&e()}};r.data=t;i=wx.setStorage;try{i&&i(r)}catch(n){b.e("存储错误",n)}},get:function(n,t){var e;e=wx.getStorage;try{e&&e({key:n,success:function(n){"function"==typeof t&&t(n.data)},fail:function(e){b().w(n+": "+e.errMsg);"function"==typeof t&&t()}})}catch(n){b.e("获取storage错误",n)}},remove:function(n,t){var e;e=wx.removeStorage;try{e&&e({key:n,success:function(){"function"==typeof t&&t(!0)},fail:function(){"function"==typeof t&&t(!1)}})}catch(n){b.e("删除storage错误",n)}}},x={stringify:function(n){if(n)try{return JSON.stringify(n)}catch(n){}return""},parse:function(n){if(n)try{return JSON.parse(n)}catch(n){}return null},parseToArray:function(n){if(n)try{return JSON.parse(n)}catch(n){}return[]}},V=function(){function n(){var n={};this.useOpenid=function(){return n.useOpenid};this.autoGetOpenid=function(){return n.autoGetOpenid};this.appKey=function(){return n.appKey};this.uploadUserInfo=function(){return n.uploadUserInfo};this.set=function(t){n=t};this.get=function(){return n};this.setItem=function(t,e){n[t]=e};this.getItem=function(t){return n[t]}}var t=null;return function(){t||(t=new n);return t}}(),F=function(){function n(){this.load=function(n){if(i){M.remove(e);n()}else{e="um_cache_"+V().appKey();M.get(e,function(t){i=x.parse(t)||{};r=!0;M.remove(e);n()})}};this.save=function(){i&&M.set(e,x.stringify(i))};this.set=function(n,t){i&&(i[n]=t)};this.get=function(n){return(i||{})[n]};this.remove=function(n){i&&i[n]&&delete i[n]};this.getAll=function(){return i};this.clear=function(){i=null};this.has=function(n){return!!this.get(n)};this.isLoaded=function(){return r}}var t=null,e="",i=null,r=!1;return function(){t||(t=new n);return t}}(),K="",G={SESSION_INTERVAL:3e4,LOG_URL:K="https://ulogs.umeng.com/wxm_logs",GET_OPENID_URL:"https://ulogs.umeng.com/uminiprogram_logs/wx/getuut",USERINFO_URL:"https://ulogs.umeng.com/uminiprogram_logs/comm/uif",DEVICE_INFO_KEY:"device_info",ADVERTISING_ID:"mobile_ad_id",ANDROID_ID:"android_id",CURRENT_SESSION:"current_session",SESSION_PAUSE_TIME:"session_pause_time",EVENT_SEND_DEFAULT_INTERVAL:15e3,EVENT_LAST_SEND_TIME:"last_send_time",MAX_EVENTID_LENGTH:128,MAX_PROPERTY_KEY_LENGTH:256,MAX_PROPERTY_KEYS_COUNT:100,REPORT_POLICY:"report_policy",REPORT_INTERVAL_TIME:"report_interval_time",REPORT_POLICY_START_SEND:"1",REPORT_POLICY_INTERVAL:"6",IMPRINT:"imprint",SEED_VERSION:"1.0.0",IMPL_VERSION:"2.3.0",ALIPAY_AVAILABLE_VERSION:"10.1.52",SHARE_PATH:"um_share_path",SHARES:"shares",REQUESTS:"requests",UUID:"um_uuid",UUID_SUFFIX:"ud",OPENID:"um_od",UNIONID:"um_unid",ALIPAYID:"um_alipayid",USERID:"um_userid",PROVIDER:"um_provider",LAUNCH_OPTIONS:"LAUNCH_OPTIONS",UM_SSRC:"_um_ssrc",USER_INFO:"user_info",IS_ALIYUN:!1,ALIYUN_URL:"serverless.huoban.youmeng.network.forward"},H={getUserInfo:function(n){wx.getSetting({success(t){t.authSetting["scope.userInfo"]?wx.getUserInfo({success:function(t){n(t&&t.userInfo)},fail:function(){n({})}}):n({})},fail(){n({})}})},getSystemInfo:function(n,t){wx.getSystemInfo({success:function(t){"function"==typeof n&&n(t)},fail:function(){"function"==typeof t&&t()}})},getDeviceInfo:function(n){"function"==typeof n&&n()},checkNetworkAvailable:function(n){var t={success:function(t){var e=!1;e="none"!==t.networkType;"function"==typeof n&&n(e)},fail:function(){"function"==typeof n&&n()}};wx.getNetworkType(t)},getNetworkInfo:function(n,t){var e={success:function(t){"function"==typeof n&&n(t)},fail:function(){"function"==typeof t&&t()}};wx.getNetworkType(e)},getDeviceId:function(n,t){try{"function"==typeof n&&n("")}catch(n){b().e("getDeviceId error",n)}},getAdvertisingId:function(n,t){"function"==typeof n&&n("")},getPageName:function(){},onNetworkStatusChange:function(n){wx.onNetworkStatusChange(function(t){"function"==typeof n&&n(t.isConnected||!0)})}},Y=function(){function n(){var n=!1,t=null,e=[];this.addPageStart=function(e){if(e&&!n){t={ts:Date.now(),path:e};n=!0}};this.addPageEnd=function(i){if(n&&i&&t&&i===t.path){var r=Date.now()-t.ts;t.duration=Math.abs(r);e.push(t);t=null;n=!1}};this.get=function(){return e};this.getCurrentPage=function(){return t};this.clear=function(){e.length=0}}var t=null;return function(){t||(t=new n);return t}}(),j=5e3,q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",X=function(n){for(var t={},e=0,i=n.length;e<i;e++)t[n.charAt(e)]=e;return t}(q),J=String.fromCharCode,z=function(n){if(n.length<2)return(t=n.charCodeAt(0))<128?n:t<2048?J(192|t>>>6)+J(128|63&t):J(224|t>>>12&15)+J(128|t>>>6&63)+J(128|63&t);var t=65536+1024*(n.charCodeAt(0)-55296)+(n.charCodeAt(1)-56320);return J(240|t>>>18&7)+J(128|t>>>12&63)+J(128|t>>>6&63)+J(128|63&t)},W=function(n){return n.replace(/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,z)},Q=function(n){var t=[0,2,1][n.length%3],e=n.charCodeAt(0)<<16|(n.length>1?n.charCodeAt(1):0)<<8|(n.length>2?n.charCodeAt(2):0);return[q.charAt(e>>>18),q.charAt(e>>>12&63),t>=2?"=":q.charAt(e>>>6&63),t>=1?"=":q.charAt(63&e)].join("")},B=function(n){return n.replace(/[\s\S]{1,3}/g,Q)},Z=function(n){return B(W(n))},$=function(n,t){return t?Z(String(n)).replace(/[+\/]/g,function(n){return"+"==n?"-":"_"}).replace(/=/g,""):Z(String(n))},nn=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),tn=function(n){switch(n.length){case 4:var t=((7&n.charCodeAt(0))<<18|(63&n.charCodeAt(1))<<12|(63&n.charCodeAt(2))<<6|63&n.charCodeAt(3))-65536;return J(55296+(t>>>10))+J(56320+(1023&t));case 3:return J((15&n.charCodeAt(0))<<12|(63&n.charCodeAt(1))<<6|63&n.charCodeAt(2));default:return J((31&n.charCodeAt(0))<<6|63&n.charCodeAt(1))}},en=function(n){return n.replace(nn,tn)},rn=function(n){var t=n.length,e=t%4,i=(t>0?X[n.charAt(0)]<<18:0)|(t>1?X[n.charAt(1)]<<12:0)|(t>2?X[n.charAt(2)]<<6:0)|(t>3?X[n.charAt(3)]:0),r=[J(i>>>16),J(i>>>8&255),J(255&i)];r.length-=[0,0,2,1][e];return r.join("")},on=function(n){return n.replace(/[\s\S]{1,4}/g,rn)},un=function(n){return en(on(n))},cn={encode:$,decode:function(n){return un(String(n).replace(/[-_]/g,function(n){return"-"==n?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))}},an={base64Encode:i,base64Decode:r,isNumber:u,compareVersion:c,getRandomStr:o,clone:a,startsWith:s,endsWith:f,assign:l,deepEqual:d},sn=function(){function n(){function n(){return an.getRandomStr(10)+Date.now()+an.getRandomStr(7)+G.UUID_SUFFIX}var t="",i="",r="",o="",u="",c="";this.init=function(e){c=V().useOpenid()?"openid":"uuid";M.get(G.UUID,function(o){if(o)t=o;else{t=n();M.set(G.UUID,t)}V.useOpenid?M.get(G.OPENID,function(n){i=n;e&&e()}):e&&e();M.get(G.UNIONID,function(n){r=n})})};M.get(G.USERID,function(n){o=n});M.get(G.PROVIDER,function(n){u=n});this.getOpenIdAsync=function(n){wx.login({success:function(t){t.code?e({url:G.GET_OPENID_URL,method:"GET",data:{key:V().appKey(),code:t.code},success:function(t){if(t&&200===t.statusCode&&t.data&&t.data.data){var e=t.data.data;return n.success&&n.success(e.oid,e.uid)}n.fail&&n.fail()},fail:function(){n.fail&&n.fail()}}):n.fail&&n.fail()},fail:function(){n.fail&&n.fail()}})};this.getIdType=function(){return c};this.getIdTracking=function(){var n={};t&&(n.uuid=t);i&&(n.openid=i);r&&(n.unionid=r);o&&(n.userid=o);return n};this.setOpenid=function(n){if(n&&n!==i){i=n;M.set(G.OPENID,n)}};this.setUnionid=function(n){if(!r&&n){r=n;M.set(G.UNIONID,n)}};this.setUserid=function(n,t){if(n&&n!==o){o=n;M.set(G.USERID,n);u=t;M.set(G.PROVIDER,t)}};this.getId=function(){return V().useOpenid()?i:t};this.getUserId=function(){return o};this.getProvider=function(){return u}}var t=null;return function(){t||(t=new n);return t}}(),fn=3,ln=function(){function n(){return{add:function(n){b().v("share origin: %o",n);var t={title:n.title,path:n.path.split("?")[0],_um_sts:Date.now()},r=n.path,o=sn().getId();if(o){var u=i.split(","),c=(u=u.filter(function(n){return n.length>0})).indexOf(o);c>=0&&(u=u.slice(0,c));u.length<fn&&u.push(o);var a=u.join(",");-1!==r.indexOf("?")?r+="&_um_ssrc="+a:r+="?_um_ssrc="+a;var s=Date.now();r+="&_um_sts="+s;n.path=r;t._um_ssrc=a;t._um_sts=s}e.push(t);b().v("share: %o",n);return n},setShareSource:function(n){i=n},clear:function(){e.length=0},get:function(){return e}}}var t=null,e=[],i="";return function(){t||(t=new n);return t}}(),dn="ekvs",pn=1e4,hn=1,gn=function(){function n(){if(u.length){var n=F().get(dn);if(e(n)+u.length<=pn){n=t(n,u);F().set(dn,n)}}}function t(n,t){var e=(n=n||{})[o];Array.isArray(e)&&e.length?n[o]=e.concat(t):n[o]=[].concat(t);return n}function e(n){var t=0;for(var e in n)Array.isArray(n[e])&&(t+=n[e].length);return t}function i(){return{addEvent:function(t){if(o){u.unshift(t);if(u.length>hn){n(o);u.length=0}}else{b().w("session id is null: ",o);c.unshift(t)}},setSessionId:function(n){o=n;b().v("setSessionId: ",o);if(Array.isArray(c)&&c.length&&o){for(var t=0;t<c.length;t++)this.addEvent(c[t]);c.length=0}},getEkvs:function(){var n=F().get(dn);u&&u.length&&(n=t(n,u));return n},clear:function(){F().remove(dn);u.length=0}}}var r,o,u=[],c=[];return function(){r||(r=i());return r}}(),vn="2g",_n="3g",yn="4g",mn="none",En=" ",Sn=["access","access_subtype"],In=function(){function n(){function n(n){H.getSystemInfo(function(i){H.getNetworkInfo(function(o){var u=(o=o||{}).type||o.networkType;u===mn&&(u="unknown");var c=F().get(G.IMPRINT);c&&(r.imprint=c);t(i,u);e(i);n&&n()})})}function t(n,t,e){r.userInfo=e;r.device_type="Phone";r.sdk_version=G.IMPL_VERSION;r.appkey=V().appKey();if(n){var i,o,u,c=n.model||"",a=(n.product,n.platform||""),s=n.brand||"",f=s.toLowerCase();r.platform_sdk_version=n.SDKVersion;r.platform_version=n.version;u=(i=Math.round(n.screenWidth*n.pixelRatio))>(o=Math.round(n.screenHeight*n.pixelRatio))?i+"*"+o:o+"*"+i;r.os=a;r.font_size_setting=n.fontSizeSetting;r.device_model=c;r.device_brand=s;r.device_manufacturer=f;r.device_manuid=c.toLowerCase().indexOf(f)>-1?c:f+En+c;r.device_name=c.toLowerCase().indexOf(f)>-1?c:f+En+c;r.os_version=n.system;r.resolution=u;r.language=n.language}switch(t){case yn:r.access_subtype="LTE";r.access="4G";break;case _n:r.access_subtype="CDMA";r.access="3G";break;case vn:r.access_subtype="GRPS";r.access="2G";break;default:r.access=t;delete r.access_subtype}}function e(n){var t=[];if(n){t.push({name:"系统名",value:n.platform});t.push({name:"支付宝版本号",value:n.version})}t.push({name:"设备型号",value:r.device_model});t.push({name:"设备生产商",value:r.device_brand});t.push({name:"os版本号",value:r.os_version});t.push({name:"网络类型",value:r.access});t.push({name:"运营商",value:r.access_subtype});t.push({name:"分辨率",value:r.resolution});t.push({name:"screenWidth",value:n.screenWidth});t.push({name:"screenHeight",value:n.screenHeight});t.push({name:"pixelRatio",value:n.pixelRatio});for(var e="",i=0;i<t.length;i++){var o=t[i];e+=o.name+": "+o.value+"; "}b().v("调试辅助信息: ",e)}var i=!1,r={};r.sdk_type="wxmp";r.platform="wx";return{init:function(){n(function(){i=!0})},isLoaded:function(){return i},get:function(){return r},getSDKType:function(){return r.sdk_type},getPlatform:function(){return r.platform},getRealtimeFields:function(){var n={};Sn.forEach(function(t){n[t]=r[t]});return n},setIdTracking:function(n){this.setItem("id_tracking",n)},setIdType:function(n){this.setItem("id_type",n)},setItem:function(n,t){r[n]=t},getItem:function(n){return r[n]},updateExtraInfo:function(){H.getDeviceInfo(function(n){r.device_info=n||""})}}}var t=null;return{instance:function(){t||(t=n());return t}}}(),Tn={HALF_SESSION:"half_session",CLOSE_SESSION:"close_session",EKV:"ekv",ENTER_PAGE:"enter_page",LEAVE_PAGE:"leave_page"},Nn=function(){function n(){return{resume:function(n){var t=!1;u||(u=F().get(G.CURRENT_SESSION));var i=new Date;o=i.getTime();if(!u||!u.end_time||o-u.end_time>G.SESSION_INTERVAL){t=!0;e(n);b().v("开始新的session(%s): ",u.id,u)}else b().v("延续上一次session(%s): %s ",u.id,i.toLocaleTimeString(),u);return t},pause:function(){i()},getCurrentSessionId:function(){return(u||{}).id},getCurrentSession:function(){return u},cloneCurrentSession:function(){return an.clone(u)}}}function t(n){var t={};for(var e in n)0===e.indexOf("_um_")&&(t[e]=n[e]);return t}function e(n){try{var e=(u||{}).options||{},i=an.assign({},t(n.query));i.path=n.path||e.path;i.scene=n.scene?In.instance().getPlatform()+"_"+n.scene:e.scene;b().v("session options: ",i);var r=i[G.UM_SSRC];r&&ln().setShareSource(r);var o=Date.now();u={id:an.getRandomStr(10)+o,start_time:o,options:i}}catch(n){b().e("生成新session失败: ",n)}}function i(){if(u){var n=new Date;u.end_time=n.getTime();"number"!=typeof u.duration&&(u.duration=0);u.duration=u.end_time-o;F().set(G.CURRENT_SESSION,u);b().v("退出会话(%s): %s ",u.id,n.toLocaleTimeString(),u)}}var r=null,o=null,u=null;return function(){r||(r=n());return r}}(),An={sessions:"sn",ekvs:"e",active_user:"active_user"},On={sdk_type:"sdt",access:"ac",access_subtype:"acs",device_model:"dm",language:"lang",device_type:"dt",device_manufacturer:"dmf",device_name:"dn",platform_version:"pv",id_type:"it",font_size_setting:"fss",os_version:"ov",device_manuid:"did",platform_sdk_version:"psv",device_brand:"db",appkey:"ak",_id:"id",id_tracking:"itr",imprint:"imp",sdk_version:"sv",resolution:"rl",testToken:"ttn"},wn={uuid:"ud",unionid:"und",openid:"od",alipay_id:"ad",device_id:"dd",userid:"puid"},Rn={getClipboard:function(n){var t;t=wx.getClipboardData;try{t&&t({success:function(t){var e=t.data;"function"==typeof n&&n(e)},fail:function(){"function"==typeof n&&n("")}})}catch(n){b.e("读取clipboard发生错误",n)}},showModal:function(n){var t;t=wx.showModal;try{t&&t(n)}catch(n){b.e("展示Modal时发生错误",n)}},showToast:function(n){var t;t=wx.showToast;try{t&&t(n)}catch(n){b.e("showToast error",n)}},getUserInfo:function(n){var t,e={fail:function(){n&&n()}};t=wx.getUserInfo;e.success=function(t){if(t&&t.userInfo){var e=t.userInfo;n&&n({avatar:e.avatarUrl,nickName:e.nickName,gender:e.gender,country:e.country,province:e.province,city:e.city,language:e.language})}};try{wx.getSetting({success:function(n){n.authSetting["scope.userInfo"]&&t&&t(e)},fail:function(){n()}})}catch(n){b.e("showToast error",n)}}},kn="_UMTEST_",Pn="TEST_TOKEN",Un=function(){function n(){this.init=function(n){Rn.getClipboard(function(t){e=F().get(Pn);try{if(t&&an.startsWith(t,kn)&&t.split(kn)[1]){var i=t.split(kn)[1],r=JSON.parse(i).token;if(r){e=r;F().set(Pn,r)}}}catch(n){b().v(n)}n(!!e)})};this.getToken=function(){return e};this.clear=function(){e="";F().remove(Pn)}}var t=null,e="";return function(){t||(t=new n);return t}}(),Dn=function(){function n(t,e,i){if(In.instance().isLoaded()){e=e||{};var r=p(t),o=In.instance().getRealtimeFields();r.header=an.assign({},r.header,o);r.noCache=e.noCache;a.enqueue(r);"function"==typeof i&&i()}else setTimeout(function(){n(t,e,i)},100)}function t(n){var i=a.front(),r=function(){a.dequeue();t(n)},o=function(){var e=a.dequeue();e&&!e.noCache&&c.push(e);t(n)};if(i)S(i,r,o);else{e();n()}}function e(){c.forEach(function(n){a.enqueue(n)});c.length=0}function i(n){if(sn().getId())if(u)b().i("队列正在发送中");else{u=!0;t(function(){u=!1;"function"==typeof n&&n()})}else{b().i("获取id标识失败，暂缓发送");"function"==typeof n&&n()}}function r(){this.send=function(n,t,e){n?this.add(n,t,function(){i(e)}):i(e)};this.add=function(t,e,i){n(t,e,i)};this.load=function(){var n=F().get(G.REQUESTS);n&&n.length&&n.forEach(function(n){a.enqueue(n)});F().remove(G.REQUESTS)};this.save=function(){F().set(G.REQUESTS,an.clone(a.items()));a.clear()}}var o=null,u=!1,c=[],a=new N(50);return function(){o||(o=new r);return o}}(),Ln=function(){function n(){function n(n,t){var i=V().appKey(),r=In.instance().getSDKType(),o=sn().getId(),u=sn().getIdType();if(i&&r&&o&&u){var c={ak:V().appKey(),sdt:In.instance().getSDKType(),uin:n.nickName,uia:n.avatar,uig:n.gender,uit:n.country,uip:n.province,uic:n.city,uil:n.language,id:sn().getId(),it:sn().getIdType()},a=JSON.stringify(c);a=an.base64Encode(a);e({url:G.USERINFO_URL,method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:"ui="+a,success:function(e){b().v("用户信息上传成功: ",n);t&&t(e&&e.data&&200===e.data.code)},fail:function(){b().e("用户信息上传失败: ",n);t&&t(!1)}})}}this.update=function(){Rn.getUserInfo(function(t){if(t){var e=F().get(G.USER_INFO);e&&an.deepEqual(t,e)||n(t,function(n){n&&F().set(G.USER_INFO,t)})}})}}var t=null;return function(){t||(t=new n);return t}}(),Cn=[];w.prototype={createMethod:function(n,t,e){try{n[t]=e?function(){return e[t].apply(e,arguments)}:function(){Cn.push([t,[].slice.call(arguments)])}}catch(n){b().v("create method errror: ",n)}},installApi:function(n,t){try{var e,i,r=["resume","pause","trackEvent","trackPageStart","trackPageEnd","trackShare","setOpenid","setUnionid","setUserid"];for(e=0,i=r.length;e<i;e++)this.createMethod(n,r[e],t);if(t)for(e=0,i=Cn.length;e<i;e++){var o=Cn[e];try{t[o[0]].apply(t,o[1])}catch(n){b().v("impl[v[0]].apply error: ",o[0],n)}}}catch(n){b().v("install api errror: ",n)}}};try{var bn=App;App=function(n){R(n,"onLaunch",function(){k(n.umengConfig)});R(n,"onShow",P);R(n,"onHide",U);bn(n)}}catch(n){b().w("App重写异常")}try{var Mn=Page;Page=function(n){R(n,"onShow",D);R(n,"onHide",L);R(n,"onUnload",L);if(n.onShareAppMessage){var t=n.onShareAppMessage;n.onShareAppMessage=function(n){var e=t.call(this,n);return Fn.trackShare.call(this,e)}}Mn(n)}}catch(n){b().w("Page重写异常")}try{var xn=Component;Component=function(n){try{n.methods=n.methods||{};var t=n.methods;R(t,"onShow",D);R(t,"onHide",L);R(t,"onUnload",L);if(t.onShareAppMessage){var e=t.onShareAppMessage;t.onShareAppMessage=function(n){var t=e.call(this,n);return Fn.trackShare.call(this,t)}}xn(n)}catch(t){xn(n)}}}catch(n){b().w("Component重写异常")}var Vn=new w,Fn={_inited:!1,init:function(n){if(this._inited)b().v("已经实例过，请避免重复初始化");else if(n)if(n.appKey){V().set(n);b().setDebug(n.debug);this._inited=!0;var t=this;if(V().useOpenid()){b().tip_w("您选择了使用openid进行统计，请确保使用setOpenid回传openid或通过设置autoGetOpenid为true，并在友盟后台设置secret由友盟帮您获取")}!function(n){try{var t=new O;b().v("成功创建Lib对象");t.init(function(){b().v("Lib对象初始化成功");Vn.installApi(n,t);b().v("安装Lib接口成功")})}catch(n){b().w("创建Lib对象异常: "+n)}}(t)}else b().err("请确保传入正确的appkey");else b().err("请通过在App内添加umengConfig设置相关信息！")}};try{Vn.installApi(Fn,null);b().v("安装临时接口成功");wx.uma=Fn}catch(n){b().w("uma赋值异常: ",n)}module.exports=Fn;
